{
  "entities": {
    "AgentLogStep": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AgentLogStep",
      "type": "object",
      "description": "Stores visible logs for every message handled by the agent within a session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AgentLogStep entity."
        },
        "sessionId": {
          "type": "string",
          "description": "Reference to Session. (Relationship: Session 1:N AgentLogStep)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of the log entry.",
          "format": "date-time"
        },
        "userMessage": {
          "type": "string",
          "description": "The message sent by the user."
        },
        "modelResponse": {
          "type": "string",
          "description": "The response generated by the model."
        },
        "reasoning": {
          "type": "string",
          "description": "The reasoning process of the model."
        },
        "toolCalls": {
          "type": "array",
          "description": "Array of tool calls made by the agent in this step.",
          "items": {
            "type": "string"
          }
        },
        "toolResults": {
          "type": "array",
          "description": "Array of the tool results obtained by the agent in this step.",
          "items": {
            "type": "string"
          }
        },
        "finalResponse": {
          "type": "string",
          "description": "The final response generated by the model after tool execution."
        }
      },
      "required": [
        "id",
        "sessionId",
        "timestamp",
        "userMessage",
        "modelResponse",
        "reasoning",
        "toolCalls",
        "toolResults",
        "finalResponse"
      ]
    },
    "AgentMemoryFact": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AgentMemoryFact",
      "type": "object",
      "description": "Represents a fact stored in the agent's memory.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AgentMemoryFact entity."
        },
        "sessionId": {
          "type": "string",
          "description": "Reference to Session. (Relationship: Session 1:N AgentMemoryFact)"
        },
        "text": {
          "type": "string",
          "description": "The text content of the fact."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the fact was created.",
          "format": "date-time"
        },
        "source": {
          "type": "string",
          "description": "The source of the fact (tool, user, or agent)."
        }
      },
      "required": [
        "id",
        "sessionId",
        "text",
        "createdAt",
        "source"
      ]
    },
    "ToolMemoryData": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ToolMemoryData",
      "type": "object",
      "description": "Structured namespace for saving data specific to a tool.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ToolMemoryData entity."
        },
        "toolName": {
          "type": "string",
          "description": "Name of the tool this data belongs to."
        },
        "data": {
          "type": "string",
          "description": "The data stored by the tool. The contents of this field is tool-specific"
        }
      },
      "required": [
        "id",
        "toolName",
        "data"
      ]
    },
    "TodoItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TodoItem",
      "type": "object",
      "description": "Represents a to-do item.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TodoItem entity."
        },
        "text": {
          "type": "string",
          "description": "The text description of the to-do item."
        },
        "completed": {
          "type": "boolean",
          "description": "Indicates whether the to-do item is completed."
        }
      },
      "required": [
        "id",
        "text",
        "completed"
      ]
    },
    "Session": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Session",
      "type": "object",
      "description": "Represents a user session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Session entity."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the session was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/sessions/{sessionId}/steps/{stepId}",
        "definition": {
          "entityName": "AgentLogStep",
          "schema": {
            "$ref": "#/backend/entities/AgentLogStep"
          },
          "description": "Stores visible logs for every message handled by the agent within a session.  Path-based ownership: Access controlled by userId and sessionId.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user."
            },
            {
              "name": "sessionId",
              "description": "The ID of the session."
            },
            {
              "name": "stepId",
              "description": "The ID of the agent log step."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/sessions/{sessionId}/facts/{factId}",
        "definition": {
          "entityName": "AgentMemoryFact",
          "schema": {
            "$ref": "#/backend/entities/AgentMemoryFact"
          },
          "description": "Agent-level memory facts associated with a user session. Path-based ownership: Access controlled by userId and sessionId.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user."
            },
            {
              "name": "sessionId",
              "description": "The ID of the session."
            },
            {
              "name": "factId",
              "description": "The ID of the agent memory fact."
            }
          ]
        }
      },
      {
        "path": "/tool_memory/{toolName}/{dataId}",
        "definition": {
          "entityName": "ToolMemoryData",
          "schema": {
            "$ref": "#/backend/entities/ToolMemoryData"
          },
          "description": "Structured namespace for saving data specific to a tool.",
          "params": [
            {
              "name": "toolName",
              "description": "The name of the tool."
            },
            {
              "name": "dataId",
              "description": "The ID of the tool memory data."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/todos/{todoId}",
        "definition": {
          "entityName": "TodoItem",
          "schema": {
            "$ref": "#/backend/entities/TodoItem"
          },
          "description": "Represents a user's to-do items. Path-based ownership: Access controlled by userId.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user."
            },
            {
              "name": "todoId",
              "description": "The ID of the to-do item."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the MCP agent sandbox with Firestore memory. It prioritizes authorization independence and simple security rules by leveraging path-based ownership and structural segregation. Each collection serves a specific purpose, aligning with the application's core features:\n\n*   `/users/{userId}/sessions/{sessionId}/steps/{stepId}`: Stores agent logs associated with a user's session. This path establishes clear ownership. Security rules can easily restrict access to logs based on the user ID.\n*   `/users/{userId}/sessions/{sessionId}/facts/{factId}`: Stores agent memory facts. Similar to logs, this path ensures that memory facts are associated with a specific user session and simplifies access control.\n*   `/tool_memory/{toolName}/{dataId}`: Stores data specific to a tool, providing a structured namespace for tool-related information.  Since any tool can be called, authentication will have to be done on the server side with the service account.\n*   `/users/{userId}/todos/{todoId}`: Stores a user's todo items. This enforces ownership at the path level.\n\nThis structure achieves Authorization Independence by avoiding hierarchical `get()` calls in security rules.  Access to log steps and memory facts is determined solely by the user ID present in the path, not by checking data in parent documents.  QAPs are supported through segregation: each collection has a homogeneous security posture, enabling secure `list` operations based on path-based ownership."
  }
}